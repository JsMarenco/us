---
// Third-party dependencies

// Current project dependencies
import Layout from "../layouts/Main.astro";
import prisma from "../lib/prisma";
import timeAgo from "../utils/timeAgo";
import { defaultAvatar } from "../constants/index";

// Current project dependencies

export const prerender = false;
// eslint-disable-next-line astro/no-exports-from-components
export const ssr = true;

const users = await prisma.user.findMany({
  orderBy: {
    createdAt: "desc",
  },
  include: {
    createdDeYoPaTus: true, // Incluir todos los Jopatu creados por el usuario
  },
});
---

<Layout
  description="Lista de usuarios registrados en el sitio."
  image="/assets/backgrounds/users.png"
  title={`Usuarios (${users.length} ${users.length === 1 ? "usuario" : "usuarios"})`}
>
  <div
    class="grid grid-cols-1 gap-6 p-4 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5"
  >
    {
      users.map((user) => (
        <a
          class="flex flex-col items-center rounded-xl border border-white/10 bg-white/20 p-6 text-center backdrop-blur-md transition-transform hover:scale-105 dark:border-gray-700/20 dark:bg-gray-900/40"
          href={`/u/${user.username}`}
        >
          <div class="mb-4 h-24 w-24 overflow-hidden rounded-full">
            <img
              alt={user.username}
              class="h-full w-full object-cover"
              src={defaultAvatar(user.avatarSrc, user.username)}
            />
          </div>

          <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100">
            {user.username}
          </h3>

          {user.firstName || user.lastName ? (
            <p class="text-sm text-gray-600 dark:text-gray-400">
              {`${user.firstName ?? ""} ${user.lastName ?? ""}`.trim()}
            </p>
          ) : null}

          {user.bio ? (
            <p class="mt-2 line-clamp-3 text-sm text-gray-700 dark:text-gray-300">
              {user.bio}
            </p>
          ) : null}

          <p class="mt-3 text-xs text-gray-500 dark:text-gray-400">
            Creado {timeAgo(user.createdAt)}
          </p>

          {user.createdDeYoPaTus?.length ? (
            <p class="mt-1 text-xs text-indigo-500 dark:text-indigo-400">
              Deyopatu creados: {user.createdDeYoPaTus.length}
            </p>
          ) : null}
        </a>
      ))
    }
  </div>
</Layout>
